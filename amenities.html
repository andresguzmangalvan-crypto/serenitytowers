<!DOCTYPE html>
<html lang="fr-CA">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Commodités — Serenity Towers</title>

  <!-- ✅ CRITICAL for GitHub Pages subpath -->
  <base href="/serenitytowers/">

  <link rel="stylesheet" href="vendor/reset.min.css">
  <link rel="stylesheet" href="style.css?v=1">

  <style>
    body { overflow:auto !important; -webkit-overflow-scrolling: touch; background: radial-gradient(circle, #2c343f 0%, #1a1e24 100%); }

    #titleBar{ position: sticky; top: 0; }

    .amenities-layout{
      min-height: calc(100vh - 56px);
      display: grid;
      grid-template-columns: 1fr 240px;
    }
    .mobile .amenities-layout{
      min-height: calc(100vh - 64px);
      grid-template-columns: 1fr;
      grid-template-rows: auto auto;
    }

    .gallery-main{ position: relative; display: grid; grid-template-rows: 1fr auto; justify-items: center; align-items: center; padding: 12px 0 14px; overflow: hidden; }
    .image-wrapper{ width: min(1100px, 92%); height: min(68vh, 720px); display:flex; align-items:center; justify-content:center; margin-top: 6px; }
    .main-image{ max-width:100%; max-height:100%; object-fit:contain; border-radius:14px; box-shadow:0 20px 50px rgba(0,0,0,0.60); border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); opacity:0; transform:scale(0.995); transition: opacity .35s ease, transform .35s ease; touch-action: pan-y; }

    .nav-btn{ position:absolute; top:46%; transform:translateY(-50%); background: rgba(20,24,32,.55); color:#fff; border:1px solid rgba(255,255,255,.10); width:56px; height:86px; cursor:pointer; font-size:28px; z-index:10; backdrop-filter: blur(10px); }
    .prev{ left:0; border-radius:0 14px 14px 0; }
    .next{ right:0; border-radius:14px 0 0 14px; }

    .thumbs{ width:min(1100px,92%); display:flex; gap:10px; overflow-x:auto; padding:10px 6px 6px; scroll-behavior:smooth; }
    .thumb{ flex:0 0 auto; width:92px; height:62px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04); cursor:pointer; opacity:.78; }
    .thumb.active{ opacity:1; border-color: rgba(255,255,255,.28); box-shadow: 0 10px 25px rgba(0,0,0,.35); }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

    .amenities-panel{ border-left:1px solid rgba(255,255,255,0.08); background: rgba(20,24,32,0.75); backdrop-filter: blur(10px); display:flex; flex-direction:column; }
    .mobile .amenities-panel{ border-left:none; border-top:1px solid rgba(255,255,255,0.08); }

    .panel-header{ padding:16px 14px 12px; border-bottom:1px solid rgba(255,255,255,0.08); text-align:center; }
    .panel-header img{ width:54px; height:54px; border-radius:14px; object-fit:contain; background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.10); margin-bottom:10px; }
    .panel-title{ font-weight:800; letter-spacing:.6px; font-size:14px; text-transform:uppercase; }
    .panel-subtitle{ margin-top:6px; font-size:12px; color: rgba(255,255,255,.70); }

    .panel-body{ padding:14px; display:grid; gap:12px; }
    .caption{ font-size:13px; color: rgba(255,255,255,.92); line-height:1.35; border:1px solid rgba(255,255,255,.08); background: rgba(0,0,0,.20); border-radius:12px; padding:12px; }
    .caption .label{ display:block; font-size:10px; text-transform:uppercase; letter-spacing:1.2px; color: rgba(255,255,255,.55); margin-bottom:6px; }
    .counter{ font-size:12px; color: rgba(255,255,255,.65); background: rgba(0,0,0,.20); border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:999px; text-align:center; width: fit-content; margin: 0 auto; }
    .brochure-btn{ display:inline-flex; align-items:center; justify-content:center; width:100%; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.06); color: rgba(255,255,255,.92); font-size:12px; letter-spacing:.8px; text-transform:uppercase; }
    .hint{ margin-top:auto; padding:14px; border-top:1px solid rgba(255,255,255,0.08); text-align:center; font-size:11px; color: rgba(255,255,255,.60); }
    .hint kbd{ display:inline-block; padding:2px 6px; border-radius:8px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06); font-size:11px; color: rgba(255,255,255,.80); margin:0 2px; }
  </style>
</head>

<body>
  <header id="titleBar" role="banner">
    <div class="tb-left">
      <div class="brand">
        <img class="brand-logo" src="img/serenity.png" alt="Serenity Towers">
        <div class="brand-text">
          <div class="brand-name">NordImmersive</div>
          <div class="brand-tagline">Expériences immersives 3D — Montréal</div>
        </div>
      </div>
    </div>

    <div class="tb-center">
      <div class="unit-title">Commodités</div>
      <div class="sceneName" aria-hidden="true"></div>
    </div>

    <div class="tb-right">
      <div class="tb-actions">
        <a class="tb-icon" href="index.html" aria-label="Retour à la visite"><span style="font-size:16px;line-height:1;">❮</span></a>
      </div>
    </div>
  </header>

  <div class="amenities-layout">
    <main class="gallery-main">
      <button class="nav-btn prev" type="button" aria-label="Image précédente" onclick="changeImage(-1)">❮</button>
      <div class="image-wrapper">
        <img id="display-img" class="main-image" src="" alt="Galerie des commodités">
      </div>
      <button class="nav-btn next" type="button" aria-label="Image suivante" onclick="changeImage(1)">❯</button>
      <div class="thumbs" id="thumbs-container" aria-label="Miniatures"></div>
    </main>

    <aside class="amenities-panel">
      <div class="panel-header">
        <img src="img/serenity.png" alt="Serenity Towers">
        <div class="panel-title">Serenity Towers</div>
        <div class="panel-subtitle">Unité 3 1/2 — XX10</div>
      </div>

      <div class="panel-body">
        <div class="caption">
          <span class="label">Commodité</span>
          <div id="image-caption">Chargement…</div>
        </div>

        <div id="counter" class="counter">0 / 0</div>

        <a href="brochure-serenity-towers-fr.pdf" class="brochure-btn" target="_blank" rel="noopener">
          Télécharger la brochure (PDF)
        </a>
      </div>

      <div class="hint">
        Raccourcis : <kbd>←</kbd> <kbd>→</kbd> • Quitter : <kbd>Esc</kbd>
      </div>
    </aside>
  </div>

  <script>
    // Mobile/desktop helper (same threshold as tour)
    (function() {
      if (window.matchMedia) {
        var mql = matchMedia("(max-width: 500px), (max-height: 500px)");
        var setMode = function() {
          if (mql.matches) document.body.classList.add('mobile');
          else document.body.classList.remove('mobile');
        };
        setMode();
        mql.addListener(setMode);
      }
    })();

    const images = [
      { src: "img/amenity1.jpg", title: "Piscine panoramique" },
      { src: "img/amenity2.jpg", title: "Salle d’entraînement moderne" },
      { src: "img/amenity3.jpg", title: "Salle communautaire" },
      { src: "img/amenity4.jpg", title: "Terrasse extérieure avec BBQ" }
    ];

    let currentIndex = 0;
    const imgElement = document.getElementById("display-img");
    const captionElement = document.getElementById("image-caption");
    const counterElement = document.getElementById("counter");
    const thumbsContainer = document.getElementById("thumbs-container");

    function updateThumbs() {
      document.querySelectorAll(".thumb").forEach((t, i) => t.classList.toggle("active", i === currentIndex));
    }

    function updateGallery() {
      imgElement.style.opacity = 0;
      imgElement.style.transform = "scale(0.995)";
      setTimeout(() => {
        const item = images[currentIndex];
        imgElement.src = item.src;
        captionElement.textContent = item.title;
        counterElement.textContent = (currentIndex + 1) + " / " + images.length;
        imgElement.onload = () => { imgElement.style.opacity = 1; imgElement.style.transform = "scale(1)"; };
        setTimeout(() => { imgElement.style.opacity = 1; imgElement.style.transform = "scale(1)"; }, 90);
        updateThumbs();
      }, 220);
    }

    function changeImage(step) {
      currentIndex += step;
      if (currentIndex >= images.length) currentIndex = 0;
      if (currentIndex < 0) currentIndex = images.length - 1;
      updateGallery();
    }

    // Build thumbs
    thumbsContainer.innerHTML = "";
    images.forEach((img, i) => {
      const div = document.createElement("div");
      div.className = "thumb";
      div.innerHTML = `<img src="${img.src}" alt="">`;
      div.addEventListener("click", () => { currentIndex = i; updateGallery(); });
      thumbsContainer.appendChild(div);
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") changeImage(1);
      if (e.key === "ArrowLeft") changeImage(-1);
      if (e.key === "Escape") window.location.href = "index.html";
    });

    // Swipe
    let startX = 0;
    imgElement.addEventListener("touchstart", (e) => { startX = e.touches[0].clientX; }, { passive: true });
    imgElement.addEventListener("touchend", (e) => {
      const diff = e.changedTouches[0].clientX - startX;
      if (Math.abs(diff) > 50) diff < 0 ? changeImage(1) : changeImage(-1);
    }, { passive: true });

    updateGallery();
  </script>
</body>
</html>
